<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrafficStudio | Photobooth Application</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <link rel="stylesheet" href="interface.css">

</head>
<body>
    <div class="app-container">
        <div class="main-content">
            <div class="workspace">
                <div class="canvas-container">
                    <canvas id="photoCanvas"></canvas>
                    <canvas id="templateCanvas"></canvas>
                </div>
                
                <div class="controls-panel">
                    <button class="btn-icon" id="loadImageBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Load Template">
                        <i class="bi bi-folder-plus"></i>
                    </button>
                    <input type="file" id="imageInput" accept="image/*" class="d-none">
                    
                    <button class="btn-icon" id="detectAreasBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Detect Areas">
                        <i class="bi bi-magic"></i>
                    </button>
                    
                    <div class="color-picker">
                        <input type="color" id="chromaColor" value="#00ff00" data-bs-toggle="tooltip" data-bs-placement="top" title="Chroma Key Color">
                    </div>
                    
                    <button class="btn-icon success" id="startCameraBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Start Camera">
                        <i class="bi bi-camera-video"></i>
                    </button>
                    
                    <button class="btn-icon warning" id="captureBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Capture Photo">
                        <i class="bi bi-camera"></i>
                    </button>
                    
                    <button class="btn-text auto-capture" id="autoCaptureBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Auto Capture">
                        Auto Capture
                    </button>
                    
                    <button class="btn-icon" id="exportBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Export Result">
                        <i class="bi bi-download"></i>
                    </button>
                    
                    <button class="btn-icon gif" id="createGifBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Create GIF">
                        <i class="bi bi-file-earmark-image"></i>
                    </button>
                    
                    <button class="btn-icon danger" id="resetBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Reset">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="sidebar-header">
                    <h6 class="mb-0">Detected Areas</h6>
                    <small class="text-muted" id="resultsCount">0 areas</small>
                </div>
                
                <div class="sidebar-content">
                    <div id="detectionResults">
                        <div class="empty-state">
                            <i class="bi bi-border-style"></i>
                            <p>No areas detected</p>
                            <small>Load a template and detect areas to get started</small>
                        </div>
                    </div>
                    
                    <div class="section-title">Camera Preview</div>
                    <div class="webcam-preview-container">
                        <div class="webcam-preview" id="webcamPreview">
                            <video id="webcamVideo" autoplay playsinline class="d-none"></video>
                            <canvas id="captureOverlay" class="d-none"></canvas>
                            <div id="countdownOverlay" class="countdown-overlay d-none">
                                <div class="countdown-number" id="countdownNumber">10</div>
                                <div class="countdown-message" id="countdownMessage">Get ready!</div>
                            </div>
                        </div>
                        <div class="preview-controls">
                            <button class="btn btn-sm btn-outline-secondary" id="detachPreviewBtn">
                                <i class="bi bi-arrows-move"></i> Detach Preview
                            </button>
                            <button class="btn btn-sm btn-outline-info" id="cameraOptionsBtn">
                                <i class="bi bi-gear"></i> Camera Options
                            </button>
                        </div>
                    </div>
                    
                    <div class="section-title">Detection Settings</div>
                    <div class="slider-container">
                        <label for="tolerance">Tolerance:</label>
                        <input type="range" class="form-range" id="tolerance" min="0" max="100" value="20">
                        <span id="toleranceValue" class="value-display">20</span>
                    </div>
                    
                    <div class="slider-container">
                        <label for="minArea">Min Area:</label>
                        <input type="range" class="form-range" id="minArea" min="100" max="5000" value="500" step="100">
                        <span id="minAreaValue" class="value-display">500</span>
                    </div>
                    
                    <div class="slider-container">
                        <label for="feathering">Feathering:</label>
                        <input type="range" class="form-range" id="feathering" min="0" max="10" value="2">
                        <span id="featheringValue" class="value-display">2</span>
                    </div>
                    
                    <div class="section-title">Auto Capture Settings</div>
                    <div class="slider-container">
                        <label for="idleTime">Idle Time (s):</label>
                        <input type="range" class="form-range" id="idleTime" min="3" max="60" value="10">
                        <span id="idleTimeValue" class="value-display">10</span>
                    </div>
                    
                    <div class="slider-container">
                        <label for="countdownTime">Countdown (s):</label>
                        <input type="range" class="form-range" id="countdownTime" min="1" max="5" value="3">
                        <span id="countdownTimeValue" class="value-display">3</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <span id="statusText">Ready to load template</span>
        </div>
    </div>

    <!-- Crop Modal -->
    <div class="modal fade" id="cropModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Crop Image for Area <span id="cropAreaId"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="cropper-container">
                        <img id="cropImage" src="" alt="Image to crop">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="applyCrop">Apply Crop</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal fade" id="exportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Export Image</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="exportFileName" class="form-label">File Name</label>
                        <input type="text" class="form-control" id="exportFileName" value="">
                    </div>
                    <div class="mb-3">
                        <label for="exportDPI" class="form-label">Quality (DPI)</label>
                        <select class="form-select" id="exportDPI">
                            <option value="300">300 DPI (High Quality)</option>
                            <option value="600" selected>600 DPI (Excellent)</option>
                            <option value="1200">1200 DPI (Ultra Sharp)</option>
                            <option value="2400">2400 DPI (Seraphim)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Export Quality</label>
                        <div class="quality-options">
                            <button type="button" class="btn btn-outline-primary quality-option active" data-quality="1.0">High</button>
                            <button type="button" class="btn btn-outline-primary quality-option" data-quality="0.95">Balanced</button>
                            <button type="button" class="btn btn-outline-primary quality-option" data-quality="0.9">Good</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmExport">Export</button>
                </div>
            </div>
        </div>
    </div>

    <!-- GIF Export Modal -->
    <div class="modal fade" id="gifExportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create GIF Slideshow</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="gifFileName" class="form-label">File Name</label>
                        <input type="text" class="form-control" id="gifFileName" value="photo-slideshow">
                    </div>
                    <div class="mb-3">
                        <label for="gifFrameDuration" class="form-label">Frame Duration (ms)</label>
                        <input type="number" class="form-control" id="gifFrameDuration" value="1000" min="100" max="5000">
                        <div class="form-text">Each photo will be displayed for this duration (1000ms = 1 second)</div>
                    </div>
                    <div class="mb-3">
                        <label for="gifQuality" class="form-label">GIF Quality</label>
                        <select class="form-select" id="gifQuality">
                            <option value="1">Ultra High (Slow)</option>
                            <option value="5" selected>High Quality</option>
                            <option value="10">Balanced</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">GIF Dimensions</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="gifWidth" placeholder="Width" value="800">
                            <span class="input-group-text">×</span>
                            <input type="number" class="form-control" id="gifHeight" placeholder="Height" value="600">
                        </div>
                        <div class="form-text">Larger dimensions = better quality but larger file size</div>
                    </div>
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        The GIF will include all photos currently placed in the template, using their current cropping and scaling.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmGifExport">Create GIF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Camera Options Modal -->
    <div class="modal fade" id="cameraOptionsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Camera Options</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="cameraSelect" class="form-label">Select Camera</label>
                        <select class="form-select" id="cameraSelect">
                            <option value="">Select Camera</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="resolutionSelect" class="form-label">Resolution</label>
                        <select class="form-select" id="resolutionSelect">
                            <option value="640x480">640 × 480 (Standard)</option>
                            <option value="1280x720" selected>1280 × 720 (HD)</option>
                            <option value="1920x1080">1920 × 1080 (Full HD)</option>
                        </select>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="mirrorPreview" checked>
                        <label class="form-check-label" for="mirrorPreview">Mirror Preview</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="applyCameraOptions">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p id="loadingText">Processing high-quality export...</p>
        <small class="text-muted">This may take a moment</small>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="LICENSE.js"></script>
    <script src="main.js"></script>
    <script src="gif.js"></script> 

</body>
</html>