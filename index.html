<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChromaKey Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <link rel="stylesheet" href="interface.css">
    <script src="gif.js"></script>

</head>
<body>
    <div class="app-container">
        <div class="main-content">
            <div class="workspace">
                <div class="canvas-container">
                    <canvas id="photoCanvas"></canvas>
                    <canvas id="templateCanvas"></canvas>
                </div>
                
                <div class="controls-panel">
                    <button class="btn-icon" id="loadImageBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Load Template">
                        <i class="bi bi-folder-plus"></i>
                    </button>
                    <input type="file" id="imageInput" accept="image/*" class="d-none">
                    
                    <button class="btn-icon" id="detectAreasBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Detect Areas">
                        <i class="bi bi-magic"></i>
                    </button>
                    
                    <div class="color-picker">
                        <input type="color" id="chromaColor" value="#00ff00" data-bs-toggle="tooltip" data-bs-placement="top" title="Chroma Key Color">
                    </div>
                    
                    <button class="btn-icon success" id="startCameraBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Start Camera">
                        <i class="bi bi-camera-video"></i>
                    </button>
                    
                    <button class="btn-icon warning" id="captureBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Capture Photo">
                        <i class="bi bi-camera"></i>
                    </button>
                    
                    <button class="btn-text" id="autoCaptureBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Auto Capture Sequence">
                        Auto Capture
                    </button>
                    
                    <button class="btn-icon" id="exportBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Export Result">
                        <i class="bi bi-download"></i>
                    </button>
                    
                    <button class="btn-icon gif" id="createGifBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Create GIF">
                        <i class="bi bi-file-earmark-image"></i>
                    </button>
                    
                    <button class="btn-icon" id="cameraSettingsBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Camera Settings">
                        <i class="bi bi-gear"></i>
                    </button>
                    
                    <button class="btn-icon" id="togglePreviewBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Show Preview on Second Screen">
                        <i class="bi bi-arrows-move"></i>
                    </button>
                    
                    <button class="btn-icon danger" id="resetCanvasBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Reset Canvas">
                        <i class="bi bi-x-circle"></i>
                    </button>
                    
                    <button class="btn-icon danger" id="resetAppBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Reset App">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                </div>
            </div>
            
            <div class="preview-section">
                <div class="preview-content">
                    <div class="preview-scrollable">
                        <div class="section-title">
                            <i class="bi bi-camera"></i>
                            Camera Preview
                        </div>
                        <div class="webcam-preview">
                            <video id="webcamVideo" autoplay playsinline class="d-none"></video>
                            <canvas id="captureOverlay" class="d-none"></canvas>
                            <div class="countdown-message" id="countdownMessage"></div>
                            <div class="countdown-display" id="countdownDisplay"></div>
                            <div class="photo-captured" id="photoCaptured">Photo Captured!</div>
                        </div>
                        
                        <div class="section-title">
                            <i class="bi bi-border-style"></i>
                            Detected Areas
                        </div>
                        <div id="resultsCount" class="text-muted mb-2">0 areas detected</div>
                        <div id="detectionResults" class="detection-results">
                            <div class="empty-state">
                                <i class="bi bi-border-style"></i>
                                <p>No areas detected</p>
                                <small>Load a template and detect areas to get started</small>
                            </div>
                        </div>
                        
                        <div class="section-title">
                            <i class="bi bi-sliders"></i>
                            Detection Settings
                        </div>
                        <div class="slider-container">
                            <label for="tolerance">Tolerance:</label>
                            <input type="range" class="form-range" id="tolerance" min="0" max="100" value="20">
                            <span id="toleranceValue" class="value-display">20</span>
                        </div>
                        
                        <div class="slider-container">
                            <label for="minArea">Min Area:</label>
                            <input type="range" class="form-range" id="minArea" min="100" max="5000" value="500" step="100">
                            <span id="minAreaValue" class="value-display">500</span>
                        </div>
                        
                        <div class="slider-container">
                            <label for="feathering">Feathering:</label>
                            <input type="range" class="form-range" id="feathering" min="0" max="10" value="2">
                            <span id="featheringValue" class="value-display">2</span>
                        </div>
                        
                        <div class="section-title">
                            <i class="bi bi-clock"></i>
                            Auto Capture Settings
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="enableIdleTime" checked>
                            <label for="enableIdleTime">Enable Idle Time</label>
                        </div>
                        
                        <div id="idleTimeContainer">
                            <div class="slider-container">
                                <label for="idleTime">Idle Time (s):</label>
                                <input type="range" class="form-range" id="idleTime" min="3" max="30" value="10">
                                <span id="idleTimeValue" class="value-display">10</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label for="countdownTime">Countdown (s):</label>
                            <input type="range" class="form-range" id="countdownTime" min="1" max="10" value="3">
                            <span id="countdownTimeValue" class="value-display">3</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <span id="statusText">Ready to load template</span>
        </div>
    </div>

    <!-- Movable Camera Preview -->
    <div class="movable-preview-container" id="movablePreview">
        <div class="preview-header">
            <div class="preview-title">Camera Preview</div>
            <div class="preview-controls">
                <button class="preview-btn" id="closePreviewBtn">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
        </div>
        <div class="preview-content">
            <div class="preview-scrollable">
                <div class="webcam-preview">
                    <video id="movableWebcamVideo" autoplay playsinline class="d-none"></video>
                    <canvas id="movableCaptureOverlay" class="d-none"></canvas>
                    <div class="countdown-message" id="movableCountdownMessage"></div>
                    <div class="countdown-display" id="movableCountdownDisplay"></div>
                    <div class="photo-captured" id="movablePhotoCaptured">Photo Captured!</div>
                </div>
                <div class="mt-3">
                    <div class="section-title">Capture Settings</div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="movableEnableIdleTime" checked>
                        <label for="movableEnableIdleTime">Enable Idle Time</label>
                    </div>
                    
                    <div id="movableIdleTimeContainer">
                        <div class="mb-2">
                            <label class="form-label">Idle Time (seconds)</label>
                            <input type="number" class="form-control" id="movableIdleTime" value="10" min="3" max="30">
                        </div>
                    </div>
                    
                    <div class="mb-2">
                        <label class="form-label">Countdown Time (seconds)</label>
                        <input type="number" class="form-control" id="movableCountdownTime" value="3" min="1" max="10">
                    </div>
                    
                    <div class="checkbox-container">
                        <input type="checkbox" id="movableMirrorPreview">
                        <label for="movableMirrorPreview">Mirror Preview</label>
                    </div>
                    
                    <div class="d-grid gap-2 mt-3">
                        <button class="btn btn-primary btn-sm" id="movableStartAutoCaptureBtn">Start Auto Capture</button>
                        <button class="btn btn-danger btn-sm" id="movableStopAutoCaptureBtn">Stop Auto Capture</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Crop Modal -->
    <div class="modal fade" id="cropModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Crop Image for Area <span id="cropAreaId"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="cropper-container">
                        <img id="cropImage" src="" alt="Image to crop">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="applyCrop">Apply Crop</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal fade" id="exportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Export Image</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="exportFileName" class="form-label">File Name</label>
                        <input type="text" class="form-control" id="exportFileName" value="chroma-key-result">
                    </div>
                    <div class="mb-3">
                        <label for="exportDPI" class="form-label">Quality (DPI)</label>
                        <select class="form-select" id="exportDPI">
                            <option value="300">300 DPI (High Quality)</option>
                            <option value="600" selected>600 DPI (Excellent)</option>
                            <option value="1200">1200 DPI (Ultra Sharp)</option>
                            <option value="2400">2400 DPI (Print Ready)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Export Quality</label>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-primary active" data-quality="1.0">Best</button>
                            <button type="button" class="btn btn-outline-primary" data-quality="0.95">High</button>
                            <button type="button" class="btn btn-outline-primary" data-quality="0.9">Good</button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Save Location</label>
                        <div class="d-flex gap-2">
                            <input type="text" class="form-control" id="exportFolderPath" placeholder="Select folder..." readonly>
                            <button class="folder-btn" id="selectExportFolderBtn">
                                <i class="bi bi-folder"></i> Browse
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmExport">Export</button>
                </div>
            </div>
        </div>
    </div>

    <!-- GIF Export Modal -->
    <div class="modal fade" id="gifExportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create GIF Slideshow</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="gifFileName" class="form-label">File Name</label>
                        <input type="text" class="form-control" id="gifFileName" value="photo-slideshow">
                    </div>
                    <div class="mb-3">
                        <label for="gifFrameDuration" class="form-label">Frame Duration (ms)</label>
                        <input type="number" class="form-control" id="gifFrameDuration" value="1000" min="100" max="5000">
                        <div class="form-text">Each photo will be displayed for this duration (1000ms = 1 second)</div>
                    </div>
                    <div class="mb-3">
                        <label for="gifQuality" class="form-label">GIF Quality</label>
                        <select class="form-select" id="gifQuality">
                            <option value="1">Ultra High (Slow)</option>
                            <option value="5" selected>High Quality</option>
                            <option value="10">Balanced</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">GIF Dimensions</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="gifWidth" placeholder="Width" value="800">
                            <span class="input-group-text">×</span>
                            <input type="number" class="form-control" id="gifHeight" placeholder="Height" value="600">
                        </div>
                        <div class="form-text">Larger dimensions = better quality but larger file size</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Save Location</label>
                        <div class="d-flex gap-2">
                            <input type="text" class="form-control" id="gifFolderPath" placeholder="Select folder..." readonly>
                            <button class="folder-btn" id="selectGifFolderBtn">
                                <i class="bi bi-folder"></i> Browse
                            </button>
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        The GIF will include all photos currently placed in the template, using their current cropping and scaling.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmGifExport">Create GIF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Camera Settings Modal -->
    <div class="modal fade" id="cameraSettingsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Camera Settings</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="cameraSelect" class="form-label">Camera</label>
                        <select class="form-select" id="cameraSelect">
                            <option value="">Select Camera</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="resolutionSelect" class="form-label">Resolution</label>
                        <select class="form-select" id="resolutionSelect">
                            <option value="640x480">640 × 480</option>
                            <option value="1280x720" selected>1280 × 720 (HD)</option>
                            <option value="1920x1080">1920 × 1080 (Full HD)</option>
                        </select>
                    </div>
                    <div class="checkbox-container mb-3">
                        <input type="checkbox" id="mirrorCamera">
                        <label for="mirrorCamera">Mirror Camera</label>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Auto Capture Settings</label>
                        <div class="checkbox-container mb-2">
                            <input type="checkbox" id="autoEnableIdleTime" checked>
                            <label for="autoEnableIdleTime">Enable Idle Time</label>
                        </div>
                        <div class="input-group mb-2">
                            <span class="input-group-text">Idle Time</span>
                            <input type="number" class="form-control" id="autoIdleTime" value="10" min="3" max="30">
                            <span class="input-group-text">seconds</span>
                        </div>
                        <div class="input-group">
                            <span class="input-group-text">Countdown</span>
                            <input type="number" class="form-control" id="autoCountdownTime" value="3" min="1" max="10">
                            <span class="input-group-text">seconds</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveCameraSettings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p id="loadingText">Processing high-quality export...</p>
        <small class="text-muted">This may take a moment</small>
    </div>

    <script src="LICENSE.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="main.js"></script>
</body>
</html>